var FirebasePassportLogin=function(e,n,t){"use strict";function r(e,n,t,r){var o=void 0!=window.screenLeft?window.screenLeft:screen.left,i=void 0!=window.screenTop?window.screenTop:screen.top,s=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,a=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,c=s/2-t/2+o,u=a/2-r/2+i,l=window.open(e,n,"scrollbars=yes, width="+t+", height="+r+", top="+u+", left="+c);return window.focus&&l.focus(),l}function o(e){var n=d._ref.child(e);cookie.set("passportAnonymous",d._anonymousUid,{secure:0===document.location.href.indexOf("https")}),n.on("value",function(e){var t=e.val();if(t){cookie.remove("passportAnonymous"),n.remove(),n.off();try{d._oAuthWindow.close()}catch(r){console.error(r)}d._ref.unauth(),i(t)}})}function i(e){e&&d._ref.authWithCustomToken(e,function(n,t){if(n)"EXPIRED_TOKEN"==n.code&&cookie.set("passportSession",""),d._callback(n);else{var r=d._ref.child("oAuth/users").child(e.replace(/\./g,""));r.once("value",function(n){var t=n.val();t&&(t[t.provider]={cachedUserProfile:JSON.parse(t.thirdPartyUserData)},t.token=e,t.thirdPartyUserData=void 0,d._removeTokensImmediately?(r.remove(),cookie.set("passportSession","")):cookie.set("passportSession",e),d._callback(null,t))})}})}function s(e){console.log&&console.log("FirebasePassportLogin: "+e)}function a(e){return d._tokenPath+"/"+e}function c(){return d._ref.getAuth()&&d._ref.unauth(),d._ref.authAnonymously({remember:"default"}).then(function(e){var n=e.auth;return n?n.uid:void 0})["catch"](function(e){throw new Error("Anonymous login failed. Make sure Anonymous login is enabled in your Firebase")})}function u(e){var n;try{n=JSON.parse(e.data)}catch(t){}n&&"init"===n.type&&(n.redirect&&(d._redirectURL=n.redirect),c().then(function(e){d._anonymousUid=e})["catch"](console.error))}function l(){var e=d._ref.getAuth();e&&d._callback(null,{token:e.token,provider:e.provider,uid:e.uid}),window.addEventListener("message",u)}var d=this;d._ref=new Firebase(e),d._tokenPath="oAuth/login",d._oAuthServerURL=n,d._oAuthServerWindow={width:1024,height:650},d._callback=t,d._ready=!0,d._redirectURL=null,d._firebaseURL=e,d._removeTokensImmediately=!0,d.login=function(e){if(d._provider=e,!d._anonymousUid)return s("Anonymous login failed. Make sure Anonymous login is enabled in your Firebase"),c().then(function(e){throw d._anonymousUid=e,new Error("Anonymous UID for FireBase connection had not been established  but is now ready for next attempt.")});var n=a(d._anonymousUid);o(n);var t=d._oAuthServerURL+d._provider+"?oAuthTokenPath="+n+"&redirect="+encodeURIComponent(d._redirectURL);d._firebaseURL&&(t+="&firebaseURL="+encodeURIComponent(d._firebaseURL)),d._oAuthWindow=r(t,"_blank",d._oAuthServerWindow.width,d._oAuthServerWindow.height)},d.logout=function(){var e=cookie.get("passportSession");e&&d._ref.child("oAuthUsers").child(e.replace(/\./g,"")).remove(),d._ref.unauth(),cookie.set("passportSession",""),d._callback(null,null)},!function(e,n){var t=function(){return t.get.apply(t,arguments)},r=t.utils={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isPlainObject:function(e){return!!e&&"[object Object]"===Object.prototype.toString.call(e)},toArray:function(e){return Array.prototype.slice.call(e)},getKeys:Object.keys||function(e){var n=[],t="";for(t in e)e.hasOwnProperty(t)&&n.push(t);return n},escape:function(e){return String(e).replace(/[,;"\\=\s%]/g,function(e){return encodeURIComponent(e)})},retrieve:function(e,n){return null==e?n:e}};t.defaults={},t.expiresMultiplier=86400,t.set=function(t,o,i){if(r.isPlainObject(t))for(var s in t)t.hasOwnProperty(s)&&this.set(s,t[s],o);else{i=r.isPlainObject(i)?i:{expires:i};var a=i.expires!==n?i.expires:this.defaults.expires||"",c=typeof a;"string"===c&&""!==a?a=new Date(a):"number"===c&&(a=new Date(+new Date+1e3*this.expiresMultiplier*a)),""!==a&&"toGMTString"in a&&(a=";expires="+a.toGMTString());var u=i.path||this.defaults.path;u=u?";path="+u:"";var l=i.domain||this.defaults.domain;l=l?";domain="+l:"";var d=i.secure||this.defaults.secure?";secure":"";e.cookie=r.escape(t)+"="+r.escape(o)+a+u+l+d}return this},t.remove=function(e){e=r.isArray(e)?e:r.toArray(arguments);for(var n=0,t=e.length;t>n;n++)this.set(e[n],"",-1);return this},t.empty=function(){return this.remove(r.getKeys(this.all()))},t.get=function(e,t){t=t||n;var o=this.all();if(r.isArray(e)){for(var i={},s=0,a=e.length;a>s;s++){var c=e[s];i[c]=r.retrieve(o[c],t)}return i}return r.retrieve(o[e],t)},t.all=function(){if(""===e.cookie)return{};for(var n=e.cookie.split("; "),t={},r=0,o=n.length;o>r;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t},t.enabled=function(){if(navigator.cookieEnabled)return!0;var e="_"===t.set("_","_").get("_");return t.remove("_"),e},"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof exports?exports.cookie=t:window.cookie=t}(document),l()};
