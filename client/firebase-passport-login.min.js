var FirebasePassportLogin=function(e,n,t){var o=this;o._ref=e,o._tokenPath="oAuthLogin",o._oAuthServerURL=t,o._oAuthServerWindow={width:1024,height:650},o._callback=n,o._ready=!0,o._popupCenter=function(e,n,t,o){var i=void 0!=window.screenLeft?window.screenLeft:screen.left,r=void 0!=window.screenTop?window.screenTop:screen.top;width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var s=width/2-t/2+i,a=height/2-o/2+r,u=window.open(e,n,"scrollbars=yes, width="+t+", height="+o+", top="+a+", left="+s);return window.focus&&u.focus(),u},o._initializePassportLogin=function(e){var n=o._ref.child(e);n.on("value",function(e){var t=e.val();t&&(n.remove(),n.off(),o._oAuthWindow.close(),o._ref.unauth(),o._setToken(t))})},o._setToken=function(e){e&&o._ref.authWithCustomToken(e,function(n){n?("EXPIRED_TOKEN"==n.code&&cookie.set("passportSession",""),o._callback(n)):o._ref.child("oAuthUsers").child(e.replace(/\./g,"")).once("value",function(n){var t=n.val();t&&(cookie.set("passportSession",e),t[t.provider]={cachedUserProfile:JSON.parse(t.thirdPartyUserData)},t.token=e,t.thirdPartyUserData=void 0,o._callback(null,t))})})},o._log=function(e){console.log&&console.log("FirebasePassportLogin: "+e)},o.login=function(e){if(o._provider=e,o._anonymousUid){var n=[o._tokenPath,o._anonymousUid].join("/"),t=o._oAuthServerURL+o._provider+"?oAuthTokenPath="+n+"&redirect="+encodeURIComponent(window.location.href);o._oAuthWindow=o._popupCenter(t,"_blank",o._oAuthServerWindow.width,o._oAuthServerWindow.height),o._initializePassportLogin(n)}else o._log("Anonymous login failed. Make sure Anonymous login is enabled in your Firebase")},o._getAnonymousUid=function(){o._ref.getAuth()&&o._ref.unauth(),o._ref.authAnonymously(function(e,n){if(e)o._log("Anonymous login failed. Make sure Anonymous login is enabled in your Firebase");else{var t=n.auth;t&&(o._anonymousUid=t.uid)}},{remember:"default"})},o.logout=function(){var e=cookie.get("passportSession");e&&o._ref.child("oAuthUsers").child(e.replace(/\./g,"")).remove(),o._ref.unauth(),cookie.set("passportSession",""),o._callback(null,null)},o._messageHandler=function(e){"reset"===e.data&&o._getAnonymousUid()},o.init=function(){o._setToken(cookie.get("passportSession")),o._getAnonymousUid(),window.addEventListener("message",o._messageHandler)},setTimeout(function(){o.init()}),!function(e,n){var t=function(){return t.get.apply(t,arguments)},o=t.utils={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isPlainObject:function(e){return!!e&&"[object Object]"===Object.prototype.toString.call(e)},toArray:function(e){return Array.prototype.slice.call(e)},getKeys:Object.keys||function(e){var n=[],t="";for(t in e)e.hasOwnProperty(t)&&n.push(t);return n},escape:function(e){return String(e).replace(/[,;"\\=\s%]/g,function(e){return encodeURIComponent(e)})},retrieve:function(e,n){return null==e?n:e}};t.defaults={},t.expiresMultiplier=86400,t.set=function(t,i,r){if(o.isPlainObject(t))for(var s in t)t.hasOwnProperty(s)&&this.set(s,t[s],i);else{r=o.isPlainObject(r)?r:{expires:r};var a=r.expires!==n?r.expires:this.defaults.expires||"",u=typeof a;"string"===u&&""!==a?a=new Date(a):"number"===u&&(a=new Date(+new Date+1e3*this.expiresMultiplier*a)),""!==a&&"toGMTString"in a&&(a=";expires="+a.toGMTString());var c=r.path||this.defaults.path;c=c?";path="+c:"";var l=r.domain||this.defaults.domain;l=l?";domain="+l:"";var d=r.secure||this.defaults.secure?";secure":"";e.cookie=o.escape(t)+"="+o.escape(i)+a+c+l+d}return this},t.remove=function(e){e=o.isArray(e)?e:o.toArray(arguments);for(var n=0,t=e.length;t>n;n++)this.set(e[n],"",-1);return this},t.empty=function(){return this.remove(o.getKeys(this.all()))},t.get=function(e,t){t=t||n;var i=this.all();if(o.isArray(e)){for(var r={},s=0,a=e.length;a>s;s++){var u=e[s];r[u]=o.retrieve(i[u],t)}return r}return o.retrieve(i[e],t)},t.all=function(){if(""===e.cookie)return{};for(var n=e.cookie.split("; "),t={},o=0,i=n.length;i>o;o++){var r=n[o].split("=");t[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return t},t.enabled=function(){if(navigator.cookieEnabled)return!0;var e="_"===t.set("_","_").get("_");return t.remove("_"),e},"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof exports?exports.cookie=t:window.cookie=t}(document)};