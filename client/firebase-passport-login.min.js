var FirebasePassportLogin=function(e,t,r){"use strict";function n(e,t,r,n){var o=void 0!=window.screenLeft?window.screenLeft:screen.left,i=void 0!=window.screenTop?window.screenTop:screen.top,s=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,a=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,c=s/2-r/2+o,u=a/2-n/2+i,d=window.open(e,t,"scrollbars=yes, width="+r+", height="+n+", top="+u+", left="+c);return window.focus&&d.focus(),d}function o(e){var t=d._ref.child(e);cookie.set("passportAnonymous",d._anonymousUid,{secure:0===document.location.href.indexOf("https")}),t.on("value",function(e){var r=e.val();if(r){cookie.remove("passportAnonymous"),t.off(),t.remove();try{d._oAuthWindow.close()}catch(n){console.error(n)}i(r)}})}function i(e){return e?d._ref.unauth().then(function(){return d._ref.authWithCustomToken(e)}).then(function(){var t=d._ref.child("oAuth/users").child(e.replace(/\./g,""));t.once("value",function(r){var n=r.val();n&&(n[n.provider]={cachedUserProfile:JSON.parse(n.thirdPartyUserData)},n.token=e,n.thirdPartyUserData=void 0,d._removeTokensImmediately?(t.remove(),cookie.set("passportSession","")):cookie.set("passportSession",e),d._callback(null,n))})})["catch"](function(e){"EXPIRED_TOKEN"==e.code&&cookie.set("passportSession",""),d._callback(e)}):void 0}function s(e){return d._tokenPath+"/"+e}function a(){for(var e=[],t=0;5>t;++t)e.push(Math.random().toString(16).substr(3,7));var r=e.join("-");return r}function c(e){var t;try{t=JSON.parse(e.data)}catch(r){}t&&"init"===t.type&&t.redirect&&(d._redirectURL=t.redirect)}function u(){var e=d._ref.getAuth();e&&d._callback(null,{token:e.token,provider:e.provider,uid:e.uid}),window.addEventListener("message",c)}var d=this;d._ref=new Firebase(e),d._tokenPath="oAuth/login",d._oAuthServerURL=t,d._oAuthServerWindow={width:1024,height:650},d._callback=r,d._ready=!0,d._redirectURL=null,d._firebaseURL=e,d._removeTokensImmediately=!0,d.login=function(e){d._provider=e,d._anonymousUid=a();var t=s(d._anonymousUid);o(t);var r=d._oAuthServerURL+d._provider+"?oAuthTokenPath="+t+"&redirect="+encodeURIComponent(d._redirectURL);d._firebaseURL&&(r+="&firebaseURL="+encodeURIComponent(d._firebaseURL)),d._oAuthWindow=n(r,"_blank",d._oAuthServerWindow.width,d._oAuthServerWindow.height)},d.logout=function(){var e=cookie.get("passportSession");e&&d._ref.child("oAuthUsers").child(e.replace(/\./g,"")).remove(),d._ref.unauth(),cookie.set("passportSession",""),d._callback(null,null)},!function(e,t){var r=function(){return r.get.apply(r,arguments)},n=r.utils={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isPlainObject:function(e){return!!e&&"[object Object]"===Object.prototype.toString.call(e)},toArray:function(e){return Array.prototype.slice.call(e)},getKeys:Object.keys||function(e){var t=[],r="";for(r in e)e.hasOwnProperty(r)&&t.push(r);return t},escape:function(e){return String(e).replace(/[,;"\\=\s%]/g,function(e){return encodeURIComponent(e)})},retrieve:function(e,t){return null==e?t:e}};r.defaults={},r.expiresMultiplier=86400,r.set=function(r,o,i){if(n.isPlainObject(r))for(var s in r)r.hasOwnProperty(s)&&this.set(s,r[s],o);else{i=n.isPlainObject(i)?i:{expires:i};var a=i.expires!==t?i.expires:this.defaults.expires||"",c=typeof a;"string"===c&&""!==a?a=new Date(a):"number"===c&&(a=new Date(+new Date+1e3*this.expiresMultiplier*a)),""!==a&&"toGMTString"in a&&(a=";expires="+a.toGMTString());var u=i.path||this.defaults.path;u=u?";path="+u:"";var d=i.domain||this.defaults.domain;d=d?";domain="+d:"";var l=i.secure||this.defaults.secure?";secure":"";e.cookie=n.escape(r)+"="+n.escape(o)+a+u+d+l}return this},r.remove=function(e){e=n.isArray(e)?e:n.toArray(arguments);for(var t=0,r=e.length;r>t;t++)this.set(e[t],"",-1);return this},r.empty=function(){return this.remove(n.getKeys(this.all()))},r.get=function(e,r){r=r||t;var o=this.all();if(n.isArray(e)){for(var i={},s=0,a=e.length;a>s;s++){var c=e[s];i[c]=n.retrieve(o[c],r)}return i}return n.retrieve(o[e],r)},r.all=function(){if(""===e.cookie)return{};for(var t=e.cookie.split("; "),r={},n=0,o=t.length;o>n;n++){var i=t[n].split("=");r[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return r},r.enabled=function(){if(navigator.cookieEnabled)return!0;var e="_"===r.set("_","_").get("_");return r.remove("_"),e},"function"==typeof define&&define.amd?define(function(){return r}):"undefined"!=typeof exports?exports.cookie=r:window.cookie=r}(document),u()};