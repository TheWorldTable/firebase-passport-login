var FirebasePassportLogin=function(e,t,n,o){var r=this;r._ref=e,r._tokenPath="oAuth/login",r._oAuthServerURL=n,r._oAuthServerWindow={width:1024,height:650},r._callback=t,r._ready=!0,r._redirectURL=null,r._firebaseURL=o,r._removeTokensImmediately=!0,r._popupCenter=function(e,t,n,o){var r=void 0!=window.screenLeft?window.screenLeft:screen.left,i=void 0!=window.screenTop?window.screenTop:screen.top;width=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,height=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height;var s=width/2-n/2+r,a=height/2-o/2+i,u=window.open(e,t,"scrollbars=yes, width="+n+", height="+o+", top="+a+", left="+s);return window.focus&&u.focus(),u},r._initializePassportLogin=function(e){var t=r._ref.child(e);cookie.set("passportAnonymous",r._anonymousUid,{secure:0===document.location.href.indexOf("https")}),t.on("value",function(e){var n=e.val();if(n){cookie.remove("passportAnonymous"),t.remove(),t.off();try{r._oAuthWindow.close()}catch(o){console.error(o)}r._ref.unauth(),r._setToken(n)}})},r._setToken=function(e){e&&r._ref.authWithCustomToken(e,function(t){if(t)"EXPIRED_TOKEN"==t.code&&cookie.set("passportSession",""),r._callback(t);else{var n=r._ref.child("oAuth/users").child(e.replace(/\./g,""));n.once("value",function(t){var o=t.val();o&&(o[o.provider]={cachedUserProfile:JSON.parse(o.thirdPartyUserData)},o.token=e,o.thirdPartyUserData=void 0,r._removeTokensImmediately?(n.remove(),cookie.set("passportSession","")):cookie.set("passportSession",e),r._callback(null,o))})}})},r._log=function(e){console.log&&console.log("FirebasePassportLogin: "+e)},r._oAuthTokenPath=function(){return[r._tokenPath,r._anonymousUid].join("/")},r.login=function(e){if(r._provider=e,r._anonymousUid){var t=r._oAuthTokenPath(),n=r._oAuthServerURL+r._provider+"?oAuthTokenPath="+t+"&redirect="+encodeURIComponent(r._redirectURL);r._firebaseURL&&(n+=encodeURIComponent(r._firebaseURL)),r._oAuthWindow=r._popupCenter(n,"_blank",r._oAuthServerWindow.width,r._oAuthServerWindow.height),r._initializePassportLogin(t)}else r._log("Anonymous login failed. Make sure Anonymous login is enabled in your Firebase")},r._getAnonymousUid=function(){r._ref.getAuth()&&r._ref.unauth(),r._ref.authAnonymously(function(e,t){if(e)r._log("Anonymous login failed. Make sure Anonymous login is enabled in your Firebase");else{var n=t.auth;n&&(r._anonymousUid=n.uid)}},{remember:"default"})},r.logout=function(){var e=cookie.get("passportSession");e&&r._ref.child("oAuthUsers").child(e.replace(/\./g,"")).remove(),r._ref.unauth(),cookie.set("passportSession",""),r._callback(null,null)},r._messageHandler=function(e){var t=JSON.parse(e.data);r._getAnonymousUid(),t.redirect&&(r._redirectURL=t.redirect)},r.init=function(){var e=cookie.get("passportAnonymous");if(e){var t=r._ref.getAuth();t&&t.uid===e?(r._anonymousUid=e,r._initializePassportLogin(r._oAuthTokenPath())):cookie.set("passportAnonymous","")}window.addEventListener("message",r._messageHandler)},setTimeout(function(){r.init()}),!function(e,t){var n=function(){return n.get.apply(n,arguments)},o=n.utils={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isPlainObject:function(e){return!!e&&"[object Object]"===Object.prototype.toString.call(e)},toArray:function(e){return Array.prototype.slice.call(e)},getKeys:Object.keys||function(e){var t=[],n="";for(n in e)e.hasOwnProperty(n)&&t.push(n);return t},escape:function(e){return String(e).replace(/[,;"\\=\s%]/g,function(e){return encodeURIComponent(e)})},retrieve:function(e,t){return null==e?t:e}};n.defaults={},n.expiresMultiplier=86400,n.set=function(n,r,i){if(o.isPlainObject(n))for(var s in n)n.hasOwnProperty(s)&&this.set(s,n[s],r);else{i=o.isPlainObject(i)?i:{expires:i};var a=i.expires!==t?i.expires:this.defaults.expires||"",u=typeof a;"string"===u&&""!==a?a=new Date(a):"number"===u&&(a=new Date(+new Date+1e3*this.expiresMultiplier*a)),""!==a&&"toGMTString"in a&&(a=";expires="+a.toGMTString());var c=i.path||this.defaults.path;c=c?";path="+c:"";var l=i.domain||this.defaults.domain;l=l?";domain="+l:"";var d=i.secure||this.defaults.secure?";secure":"";e.cookie=o.escape(n)+"="+o.escape(r)+a+c+l+d}return this},n.remove=function(e){e=o.isArray(e)?e:o.toArray(arguments);for(var t=0,n=e.length;n>t;t++)this.set(e[t],"",-1);return this},n.empty=function(){return this.remove(o.getKeys(this.all()))},n.get=function(e,n){n=n||t;var r=this.all();if(o.isArray(e)){for(var i={},s=0,a=e.length;a>s;s++){var u=e[s];i[u]=o.retrieve(r[u],n)}return i}return o.retrieve(r[e],n)},n.all=function(){if(""===e.cookie)return{};for(var t=e.cookie.split("; "),n={},o=0,r=t.length;r>o;o++){var i=t[o].split("=");n[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return n},n.enabled=function(){if(navigator.cookieEnabled)return!0;var e="_"===n.set("_","_").get("_");return n.remove("_"),e},"function"==typeof define&&define.amd?define(function(){return n}):"undefined"!=typeof exports?exports.cookie=n:window.cookie=n}(document)};